<div class="admin-wrapper wrapper">
  <div class="admin-header-flex">
    <div class="header-text">
      <h1>Panel de AdministraciÃ³n</h1>
      <p>Gestiona usuarios y horarios.</p>
    </div>
    <button class="btn-create" (click)="toggleCreateModal()">+ Nuevo Usuario</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol</th>
          <th>Especialidad</th>
          <th>Rango Horario</th> <!-- COLUMNA MODIFICADA -->
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users$ | async">

          <!-- === MODO VISTA === -->
          <ng-container *ngIf="editingId !== user.uid">
            <td>
              <div class="user-info">
                <img [src]="user.photoURL || 'https://ui-avatars.com/api/?name='+(user.displayName||user.email)"
                  class="avatar">
                <div>
                  <div class="name">{{ user.displayName || 'Sin Nombre' }}</div>
                  <div class="email">{{ user.email }}</div>
                </div>
              </div>
            </td>
            <td><span class="role-badge" [ngClass]="user.role">{{ user.role }}</span></td>
            <td>{{ user.specialty || '---' }}</td>

            <!-- VISTA DEL RANGO -->
            <td>
              <span *ngIf="user.role === 'programador'" class="time-badge">
                {{ user.horaInicio || '08:00' }} - {{ user.horaFin || '17:00' }}
              </span>
              <span *ngIf="user.role !== 'programador'" style="color: #444; font-size: 0.8rem;">N/A</span>
            </td>

            <td>
              <button class="btn-icon edit" (click)="startEdit(user)">âœŽ</button>
              <button class="btn-icon delete" (click)="deleteUser(user.uid)">ðŸ—‘</button>
            </td>
          </ng-container>

          <!-- === MODO EDICIÃ“N === -->
          <ng-container *ngIf="editingId === user.uid">
            <td><input type="text" [(ngModel)]="editForm.displayName" class="input-dark"></td>
            <td>
              <select [(ngModel)]="editForm.role" class="input-dark">
                <option value="usuario">Usuario</option>
                <option value="programador">Programador</option>
                <option value="admin">Admin</option>
              </select>
            </td>
            <td><input type="text" [(ngModel)]="editForm.specialty" class="input-dark"></td>

            <!-- EDICIÃ“N DEL RANGO (Dos Selects) -->
            <td>
              <div *ngIf="editForm.role === 'programador'" style="display: flex; gap: 5px; flex-direction: column;">
                <div style="display: flex; gap: 5px; align-items: center;">
                  <span style="color:#888; font-size: 0.8rem; width: 40px;">Desde:</span>
                  <select [(ngModel)]="editForm.horaInicio" class="input-dark">
                    <option *ngFor="let h of horasPosibles" [value]="h">{{ h }}</option>
                  </select>
                </div>
                <div style="display: flex; gap: 5px; align-items: center;">
                  <span style="color:#888; font-size: 0.8rem; width: 40px;">Hasta:</span>
                  <select [(ngModel)]="editForm.horaFin" class="input-dark">
                    <option *ngFor="let h of horasPosibles" [value]="h">{{ h }}</option>
                  </select>
                </div>
              </div>
              <span *ngIf="editForm.role !== 'programador'">N/A</span>
            </td>

            <td>
              <button class="btn-save" (click)="saveUser()">OK</button>
              <button class="btn-cancel" (click)="cancelEdit()">X</button>
            </td>
          </ng-container>

        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal sigue igual al anterior -->
<div class="modal-overlay" *ngIf="showCreateModal">
  <div class="modal-content">
    <h2>Registrar Nuevo Usuario</h2>
    <div class="form-group">
      <label>Nombre</label>
      <input type="text" [(ngModel)]="newUser.displayName" class="input-dark">
    </div>
    <div class="form-group">
      <label>Correo</label>
      <input type="email" [(ngModel)]="newUser.email" class="input-dark">
    </div>
    <div class="form-group">
      <label>Rol</label>
      <select [(ngModel)]="newUser.role" class="input-dark">
        <option value="usuario">Usuario</option>
        <option value="programador">Programador</option>
        <option value="admin">Administrador</option>
      </select>
    </div>

    <div class="form-group" *ngIf="newUser.role === 'programador'">
      <label>Especialidad</label>
      <input type="text" [(ngModel)]="newUser.specialty" class="input-dark"
        placeholder="Ej: Frontend, Backend, Bases de datos" />
    </div>

    <div class="form-group" *ngIf="newUser.role === 'programador'">
      <label>Horario de trabajo</label>

      <div style="display: flex; flex-direction: column; gap: 10px;">
        <div>
          <label style="font-size: 0.8rem; color: #aaa;">Hora de entrada</label>
          <select [(ngModel)]="newUser.horaInicio" class="input-dark">
            <option *ngFor="let hora of horasPosibles" [value]="hora">{{ hora }}</option>
          </select>
        </div>

        <div>
          <label style="font-size: 0.8rem; color: #aaa;">Hora de salida</label>
          <select [(ngModel)]="newUser.horaFin" class="input-dark">
            <option *ngFor="let hora of horasPosibles" [value]="hora">{{ hora }}</option>
          </select>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="toggleCreateModal()">Cancelar</button>
      <button class="btn-save" (click)="createUser()">Crear</button>
    </div>
  </div>
</div>