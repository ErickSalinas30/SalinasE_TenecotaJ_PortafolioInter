<div class="admin-wrapper wrapper">
  
  <!-- HEADER -->
  <div class="admin-header-flex">
    <div class="header-text">
      <h1>Panel de AdministraciÃ³n</h1>
      <p>Gestiona usuarios, roles y perfiles.</p>
    </div>

    <!-- BOTÃ“N NUEVO USUARIO -->
    <button class="btn-create" (click)="toggleCreateModal()">
      + Nuevo Usuario
    </button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol Actual</th>
          <th>Especialidad / Datos</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let user of users$ | async">

          <!-- ================= MODO VISTA ================= -->
          <ng-container *ngIf="editingId !== user.uid">

            <td>
              <div class="user-info">

                <!-- FOTO + FALLBACKS -->
                <img [src]="
                  user.photoURL ||
                  user.photoURL ||
                  'https://ui-avatars.com/api/?name=' + (user.displayName || user.displayName)
                ">

                <div>
                  <div class="name">{{ user.displayName || user.displayName }}</div>
                  <div class="email">{{ user.email }}</div>
                </div>
              </div>
            </td>

            <td>
              <span class="role-badge" [ngClass]="user.role">{{ user.role }}</span>
            </td>

            <td>
              <div>{{ user.specialty || '---' }}</div>
              <small style="color: #666" *ngIf="user.horarios">{{ user.horarios }}</small>
            </td>

            <td>
              <button class="btn-icon edit" (click)="startEdit(user)" title="Editar">âœŽ</button>
              <button class="btn-icon delete" (click)="deleteUser(user.uid)" title="Eliminar">ðŸ—‘</button>
            </td>

          </ng-container>

          <!-- ================= MODO EDICIÃ“N ================= -->
          <ng-container *ngIf="editingId === user.uid">

            <td>
              <input type="text" [(ngModel)]="editForm.displayName" class="input-dark" />
              <div class="email-readonly">{{ user.email }}</div>
            </td>

            <td>
              <select [(ngModel)]="editForm.role" class="input-dark">
                <option value="usuario">Usuario</option>
                <option value="programador">Programador</option>
                <option value="admin">Administrador</option>
              </select>
            </td>

            <td>
              <input type="text" [(ngModel)]="editForm.specialty" placeholder="Especialidad" class="input-dark mb-2">
              <input type="text" [(ngModel)]="editForm.horarios" placeholder="Horarios (Lun-Vie)" class="input-dark mb-2">
              <textarea [(ngModel)]="editForm.description" placeholder="DescripciÃ³n..." class="input-dark"></textarea>
            </td>

            <td>
              <button class="btn-save" (click)="saveUser()">Guardar</button>
              <button class="btn-cancel" (click)="cancelEdit()">X</button>
            </td>

          </ng-container>

        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ================= MODAL CREAR USUARIO ================= -->
<div class="modal-overlay" *ngIf="showCreateModal">
  <div class="modal-content">

    <h2>Registrar Nuevo Usuario</h2>

    <div class="form-group">
      <label>Nombre Completo</label>
      <input type="text" [(ngModel)]="newUser.displayName" class="input-dark" placeholder="Ej: Ana LÃ³pez">
    </div>

    <div class="form-group">
      <label>Correo ElectrÃ³nico</label>
      <input type="email" [(ngModel)]="newUser.email" class="input-dark" placeholder="usuario@gmail.com">
    </div>

    <div class="form-group">
      <label>Rol Asignado</label>
      <select [(ngModel)]="newUser.role" class="input-dark">
        <option value="usuario">Usuario Normal</option>
        <option value="programador">Programador</option>
        <option value="admin">Administrador</option>
      </select>
    </div>

    <div class="form-group">
      <label>Especialidad (Opcional)</label>
      <input type="text" [(ngModel)]="newUser.specialty" class="input-dark" placeholder="Ej: Frontend Angular">
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="toggleCreateModal()">Cancelar</button>
      <button class="btn-save" (click)="createUser()">Crear Usuario</button>
    </div>

  </div>
</div>
